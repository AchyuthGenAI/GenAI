<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat-AI</title>
    <link rel="icon" type="image/webp" href="https://i.ibb.co/MCLkk0y/icon-png.webp">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            font-family: Arial, sans-serif;
            position: relative;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: #1e2a44;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-heartbeat {
            font-size: 100px;
            color: #00c6ff;
            animation: heartbeat 1.2s infinite ease-in-out;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            20% { transform: scale(1.2); }
            40% { transform: scale(1); }
            60% { transform: scale(1.2); }
            80% { transform: scale(1); }
        }

        /* Light Theme (Default) */
        body[data-theme="light"] {
            background-color: #f5f5f5;
            color: #333333;
        }

        body[data-theme="light"] .navbar {
            background-color: #ffffff;
            color: #333333;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        body[data-theme="light"] .navbar-brand {
            color: transparent;
        }

        body[data-theme="light"] .home-button {
            color: #ffffff;
        }

        body[data-theme="light"] .history-panel {
            background-color: rgba(255, 255, 255, 0.95);
            color: #333333;
        }

        body[data-theme="light"] .history-panel h3 {
            color: #007bff;
        }

        body[data-theme="light"] .chat-container,
        body[data-theme="light"] .chat-box,
        body[data-theme="light"] .chat-box::-webkit-scrollbar-track {
            background-color: #f5f5f5;
            color: #333333;
        }

        body[data-theme="light"] .input-group,
        body[data-theme="light"] .send-btn,
        body[data-theme="light"] .voice-btn {
            background-color: #e0e0e0;
            color: #333333;
        }

        body[data-theme="light"] .stop-btn {
            background-color: #e0e0e0;
            color: #333333;
        }

        body[data-theme="light"] .newChatBtn {
            color: #ffffff;
        }

        body[data-theme="light"] .history-item {
            background-color: #ffffff;
            border: 1px solid #cccccc;
            color: #333333;
        }

        body[data-theme="light"] .history-item:hover {
            background-color: #e8ecef;
        }

        body[data-theme="light"] .history-item .content .question {
            color: #333333;
        }

        body[data-theme="light"] .history-item .content .meta {
            color: #555555;
        }

        body[data-theme="light"] .history-item .delete-btn {
            color: #dc3545;
        }

        body[data-theme="light"] .message.user {
            background-color: #e9ecef;
            color: #333333;
            margin-left: auto;
        }

        body[data-theme="light"] .message.bot {
            background-color: #e9ecef;
            color: #333333;
            margin-right: auto;
        }

        body[data-theme="light"] .markdown-container {
            color: #333333;
        }

        body[data-theme="light"] .markdown-container pre {
            background: #1e1e1e;
            color: #ffffff;
        }

        body[data-theme="light"] .markdown-container code {
            color: #ffffff;
        }

        body[data-theme="light"] footer {
            color: #555555;
        }

        body[data-theme="light"] footer a {
            color: #007bff;
        }

        body[data-theme="light"] .search-bar {
            background: linear-gradient(135deg, #ffffff, #e0e0e0);
        }

        body[data-theme="light"] .search-bar input {
            color: #333333;
        }

        body[data-theme="light"] .search-bar input::placeholder {
            color: #888888;
        }

        body[data-theme="light"] .search-bar .search-icon {
            color: #007bff;
        }

        body[data-theme="light"] .search-bar .clear-search {
            color: #666666;
        }

        body[data-theme="light"] .search-bar .clear-search:hover {
            color: #dc3545;
        }

        body[data-theme="light"] .clear-history-button,
        body[data-theme="light"] .fancy-button {
            color: #ffffff;
        }

        body[data-theme="light"] .theme-dropdown .dropdown-menu {
            background-color: #ffffff;
            border: 1px solid #cccccc;
            color: #333333;
        }

        body[data-theme="light"] .theme-dropdown .dropdown-item {
            color: #333333;
        }

        body[data-theme="light"] .theme-dropdown .dropdown-item:hover {
            background-color: #e8ecef;
            color: #333333;
        }

        body[data-theme="light"] .preview-panel {
            background-color: rgba(255, 255, sustitute255, 0.95);
            color: #333333;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        body[data-theme="light"] .preview-panel h3 {
            color: #007bff;
        }

        body[data-theme="light"] .preview-panel .preview-header button {
            color: #333333;
        }

        body[data-theme="light"] .preview-panel .preview-header button:hover {
            color: #007bff;
        }

        body[data-theme="light"] .preview-panel .close-preview-btn:hover {
            color: #dc3545;
        }

        body[data-theme="light"] .preview-panel .preview-content {
            background-color: #ffffff;
            border: 1px solid #cccccc;
        }

        /* Dark Theme */
        body[data-theme="dark"] {
            background-color: #1e2a44;
            color: #ffffff;
        }

        body[data-theme="dark"] .navbar {
            background-color: #1e2a44;
            color: #ffffff;
        }

        body[data-theme="dark"] .navbar-brand {
            color: transparent;
        }

        body[data-theme="dark"] .home-button {
            color: #ffffff;
        }

        body[data-theme="dark"] .history-panel {
            background-color: rgba(0, 0, 0, 0.95);
            color: #ffffff;
        }

        body[data-theme="dark"] .history-panel h3 {
            color: #00c6ff;
        }

        body[data-theme="dark"] .chat-container,
        body[data-theme="dark"] .chat-box,
        body[data-theme="dark"] .chat-box::-webkit-scrollbar-track {
            background-color: #1e2a44;
            color: #ffffff;
        }

        body[data-theme="dark"] .input-group,
        body[data-theme="dark"] .send-btn,
        body[data-theme="dark"] .voice-btn {
            background-color: #3a3f4b;
            color: #ffffff;
        }

        body[data-theme="dark"] .stop-btn {
            background-color: #3a3f4b;
            color: #ffffff;
        }

        body[data-theme="dark"] .newChatBtn {
            color: #ffffff;
        }

        body[data-theme="dark"] .history-item {
            background-color: #1e2a44;
            border: 1px solid #3a3f4b;
            color: #ffffff;
        }

        body[data-theme="dark"] .history-item:hover {
            background-color: #2e333f;
        }

        body[data-theme="dark"] .history-item .content .question {
            color: #ffffff;
        }

        body[data-theme="dark"] .history-item .content .meta {
            color: #aaaaaa;
        }

        body[data-theme="dark"] .history-item .delete-btn {
            color: #ff6f61;
        }

        body[data-theme="dark"] .message.user {
            background-color: #3a3f4b;
            color: #ffffff;
            margin-left: auto;
        }

        body[data-theme="dark"] .message.bot {
            background-color: #3a3f4b;
            color: #ffffff;
            margin-right: auto;
        }

        body[data-theme="dark"] .markdown-container {
            color: #ffffff;
        }

        body[data-theme="dark"] .markdown-container pre {
            background: #1e1e1e;
            color: #ffffff;
        }

        body[data-theme="dark"] .markdown-container code {
            color: #ffffff;
        }

        body[data-theme="dark"] footer {
            color: #dddddd;
        }

        body[data-theme="dark"] footer a {
            color: #00adb5;
        }

        body[data-theme="dark"] .search-bar {
            background: linear-gradient(135deg, #2e333f, #1e2a44);
        }

        body[data-theme="dark"] .search-bar input {
            color: #ffffff;
        }

        body[data-theme="dark"] .search-bar input::placeholder {
            color: #bbbbbb;
        }

        body[data-theme="dark"] .search-bar .search-icon {
            color: #00c6ff;
        }

        body[data-theme="dark"] .search-bar .clear-search {
            color: #aaaaaa;
        }

        body[data-theme="dark"] .search-bar .clear-search:hover {
            color: #ff6f61;
        }

        body[data-theme="dark"] .clear-history-button,
        body[data-theme="dark"] .fancy-button {
            color: #ffffff;
        }

        body[data-theme="dark"] .theme-dropdown .dropdown-menu {
            background-color: #2e333f;
            border: 1px solid #3a3f4b;
            color: #ffffff;
        }

        body[data-theme="dark"] .theme-dropdown .dropdown-item {
            color: #ffffff;
        }

        body[data-theme="dark"] .theme-dropdown .dropdown-item:hover {
            background-color: #3a3f4b;
            color: #ffffff;
        }

        body[data-theme="dark"] .preview-panel {
            background-color: rgba(0, 0, 0, 0.95);
            color: #ffffff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        body[data-theme="dark"] .preview-panel h3 {
            color: #00c6ff;
        }

        body[data-theme="dark"] .preview-panel .preview-header button {
            color: #ffffff;
        }

        body[data-theme="dark"] .preview-panel .preview-header button:hover {
            color: #00c6ff;
        }

        body[data-theme="dark"] .preview-panel .close-preview-btn:hover {
            color: #ff6f61;
        }

        body[data-theme="dark"] .preview-panel .preview-content {
            background-color: #1e2a44;
            border: 1px solid #3a3f4b;
        }

        /* Ocean Theme */
        body[data-theme="ocean"] {
            background-color: #e0f7fa;
            color: #003087;
        }

        body[data-theme="ocean"] .navbar {
            background-color: #b3e5fc;
            color: #003087;
        }

        body[data-theme="ocean"] .navbar-brand {
            color: transparent;
        }

        body[data-theme="ocean"] .home-button {
            color: #ffffff;
        }

        body[data-theme="ocean"] .history-panel {
            background-color: rgba(179, 229, 252, 0.95);
            color: #003087;
        }

        body[data-theme="ocean"] .history-panel h3 {
            color: #0288d1;
        }

        body[data-theme="ocean"] .chat-container,
        body[data-theme="ocean"] .chat-box,
        body[data-theme="ocean"] .chat-box::-webkit-scrollbar-track {
            background-color: #e0f7fa;
            color: #003087;
        }

        body[data-theme="ocean"] .input-group,
        body[data-theme="ocean"] .send-btn,
        body[data-theme="ocean"] .voice-btn {
            background-color: #81d4fa;
            color: #003087;
        }

        body[data-theme="ocean"] .stop-btn {
            background-color: #81d4fa;
            color: #003087;
        }

        body[data-theme="ocean"] .newChatBtn {
            color: #ffffff;
        }

        body[data-theme="ocean"] .history-item {
            background-color: #b3e5fc;
            border: 1px solid #4fc3f7;
            color: #003087;
        }

        body[data-theme="ocean"] .history-item:hover {
            background-color: #4fc3f7;
        }

        body[data-theme="ocean"] .history-item .content .question {
            color: #003087;
        }

        body[data-theme="ocean"] .history-item .content .meta {
            color: #0288d1;
        }

        body[data-theme="ocean"] .history-item .delete-btn {
            color: #d81b60;
        }

        body[data-theme="ocean"] .message.user {
            background-color: #b3e5fc;
            color: #ffffff;
            margin-left: auto;
        }

        body[data-theme="ocean"] .message.bot {
            background-color: #b3e5fc;
            color: #003087;
            margin-right: auto;
        }

        body[data-theme="ocean"] .markdown-container {
            color: #003087;
        }

        body[data-theme="ocean"] .markdown-container pre {
            background: #1e1e1e;
            color: #003087;
        }

        body[data-theme="ocean"] .markdown-container code {
            color: #003087;
        }

        body[data-theme="ocean"] footer {
            color: #003087;
        }

        body[data-theme="ocean"] footer a {
            color: #0288d1;
        }

        body[data-theme="ocean"] .search-bar {
            background: linear-gradient(135deg, #b3e5fc, #81d4fa);
        }

        body[data-theme="ocean"] .search-bar input {
            color: #003087;
        }

        body[data-theme="ocean"] .search-bar input::placeholder {
            color: #0288d1;
        }

        body[data-theme="ocean"] .search-bar .search-icon {
            color: #0288d1;
        }

        body[data-theme="ocean"] .search-bar .clear-search {
            color: #0288d1;
        }

        body[data-theme="ocean"] .search-bar .clear-search:hover {
            color: #d81b60;
        }

        body[data-theme="ocean"] .clear-history-button,
        body[data-theme="ocean"] .fancy-button {
            color: #ffffff;
        }

        body[data-theme="ocean"] .theme-dropdown .dropdown-menu {
            background-color: #b3e5fc;
            border: 1px solid #4fc3f7;
            color: #003087;
        }

        body[data-theme="ocean"] .theme-dropdown .dropdown-item {
            color: #003087;
        }

        body[data-theme="ocean"] .theme-dropdown .dropdown-item:hover {
            background-color: #4fc3f7;
            color: #003087;
        }

        body[data-theme="ocean"] .preview-panel {
            background-color: rgba(179, 229, 252, 0.95);
            color: #003087;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        body[data-theme="ocean"] .preview-panel h3 {
            color: #0288d1;
        }

        body[data-theme="ocean"] .preview-panel .preview-header button {
            color: #003087;
        }

        body[data-theme="ocean"] .preview-panel .preview-header button:hover {
            color: #0288d1;
        }

        body[data-theme="ocean"] .preview-panel .close-preview-btn:hover {
            color: #d81b60;
        }

        body[data-theme="ocean"] .preview-panel .preview-content {
            background-color: #b3e5fc;
            border: 1px solid #4fc3f7;
        }

        /* Forest Theme */
        body[data-theme="forest"] {
            background-color: #e8f5e9;
            color: #1b5e20;
        }

        body[data-theme="forest"] .navbar {
            background-color: #c8e6c9;
            color: #1b5e20;
        }

        body[data-theme="forest"] .navbar-brand {
            color: transparent;
        }

        body[data-theme="forest"] .home-button {
            color: #ffffff;
        }

        body[data-theme="forest"] .history-panel {
            background-color: rgba(200, 230, 201, 0.95);
            color: #1b5e20;
        }

        body[data-theme="forest"] .history-panel h3 {
            color: #388e3c;
        }

        body[data-theme="forest"] .chat-container,
        body[data-theme="forest"] .chat-box,
        body[data-theme="forest"] .chat-box::-webkit-scrollbar-track {
            background-color: #e8f5e9;
            color: #1b5e20;
        }

        body[data-theme="forest"] .input-group,
        body[data-theme="forest"] .send-btn,
        body[data-theme="forest"] .voice-btn {
            background-color: #a5d6a7;
            color: #1b5e20;
        }

        body[data-theme="forest"] .stop-btn {
            background-color: #a5d6a7;
            color: #1b5e20;
        }

        body[data-theme="forest"] .newChatBtn {
            color: #ffffff;
        }

        body[data-theme="forest"] .history-item {
            background-color: #c8e6c9;
            border: 1px solid #81c784;
            color: #1b5e20;
        }

        body[data-theme="forest"] .history-item:hover {
            background-color: #81c784;
        }

        body[data-theme="forest"] .history-item .content .question {
            color: #1b5e20;
        }

        body[data-theme="forest"] .history-item .content .meta {
            color: #388e3c;
        }

        body[data-theme="forest"] .history-item .delete-btn {
            color: #d32f2f;
        }

        body[data-theme="forest"] .message.user {
            background-color: #388e3c;
            color: #ffffff;
            margin-left: auto;
        }

        body[data-theme="forest"] .message.bot {
            background-color: #c8e6c9;
            color: #1b5e20;
            margin-right: auto;
        }

        body[data-theme="forest"] .markdown-container {
            color: #1b5e20;
        }

        body[data-theme="forest"] .markdown-container pre {
            background: #1e1e1e;
            color: #1b5e20;
        }

        body[data-theme="forest"] .markdown-container code {
            color: #1b5e20;
        }

        body[data-theme="forest"] footer {
            color: #1b5e20;
        }

        body[data-theme="forest"] footer a {
            color: #388e3c;
        }

        body[data-theme="forest"] .search-bar {
            background: linear-gradient(135deg, #c8e6c9, #a5d6a7);
        }

        body[data-theme="forest"] .search-bar input {
            color: #1b5e20;
        }

        body[data-theme="forest"] .search-bar input::placeholder {
            color: #388e3c;
        }

        body[data-theme="forest"] .search-bar .search-icon {
            color: #388e3c;
        }

        body[data-theme="forest"] .search-bar .clear-search {
            color: #388e3c;
        }

        body[data-theme="forest"] .search-bar .clear-search:hover {
            color: #d32f2f;
        }

        body[data-theme="forest"] .clear-history-button,
        body[data-theme="forest"] .fancy-button {
            color: #ffffff;
        }

        body[data-theme="forest"] .theme-dropdown .dropdown-menu {
            background-color: #c8e6c9;
            border: 1px solid #81c784;
            color: #1b5e20;
        }

        body[data-theme="forest"] .theme-dropdown .dropdown-item {
            color: #1b5e20;
        }

        body[data-theme="forest"] .theme-dropdown .dropdown-item:hover {
            background-color: #81c784;
            color: #1b5e20;
        }

        body[data-theme="forest"] .preview-panel {
            background-color: rgba(200, 230, 201, 0.95);
            color: #1b5e20;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        body[data-theme="forest"] .preview-panel h3 {
            color: #388e3c;
        }

        body[data-theme="forest"] .preview-panel .preview-header button {
            color: #1b5e20;
        }

        body[data-theme="forest"] .preview-panel .preview-header button:hover {
            color: #388e3c;
        }

        body[data-theme="forest"] .preview-panel .close-preview-btn:hover {
            color: #d32f2f;
        }

        body[data-theme="forest"] .preview-panel .preview-content {
            background-color: #c8e6c9;
            border: 1px solid #81c784;
        }

        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .navbar-center {
            display: flex;
            align-items: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .navbar-brand {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00c6ff, #0072ff, #ff00ff, #ff6f61);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .container {
            display: flex;
            height: calc(100vh - 70px - 60px);
            overflow: hidden;
            flex-direction: column;
            margin-top: 70px;
            margin-bottom: 60px;
            position: relative;
        }

        .history-panel {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%) scale(0);
            width: 90%;
            max-width: 400px;
            height: calc(100vh - 100px);
            padding: 20px;
            z-index: 1000;
            transition: transform 0.3s ease, opacity 0.3s ease;
            opacity: 0;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            border-radius: 12px;
        }

        .history-panel.active {
            transform: translateX(-50%) scale(1);
            opacity: 1;
        }

        .history-panel .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
        }

        .history-panel .close-btn:hover {
            color: #ff3f31;
        }

        .history-panel::-webkit-scrollbar {
            width: 8px;
        }

        .history-panel::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 50px;
        }

        .history-panel::-webkit-scrollbar-track {
            border-radius: 50px;
        }

        body[data-theme="light"] .history-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.7);
        }

        body[data-theme="dark"] .history-panel::-webkit-scrollbar-track {
            background: rgba(20, 20, 20, 0.7);
        }

        body[data-theme="ocean"] .history-panel::-webkit-scrollbar-track {
            background: rgba(179, 229, 252, 0.7);
        }

        body[data-theme="forest"] .history-panel::-webkit scrollbar-track {
            background: rgba(200, 230, 201, 0.7);
        }

        .history-panel h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .toggle-history {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: #ffffff;
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .toggle-history:hover {
            background: linear-gradient(135deg, #2575fc, #6a11cb);
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .toggle-history i {
            font-size: 20px;
        }

        .theme-dropdown {
            display: flex;
            align-items: center;
        }

        .theme-dropdown .btn {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: #ffffff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .theme-dropdown .btn:hover {
            background: linear-gradient(135deg, #2575fc, #6a11cb);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .theme-dropdown .btn:active {
            transform: scale(0.95);
        }

        .theme-dropdown .dropdown-menu {
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            min-width: 120px;
        }

        .theme-dropdown .dropdown-item {
            padding: 8px 16px;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .theme-dropdown .dropdown-item:hover {
            cursor: pointer;
        }

        .search-bar {
            position: relative;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            border-radius: 25px;
            padding: 5px 10px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .search-bar:hover,
        .search-bar.active {
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(0, 198, 255, 0.2);
        }

        .search-bar input {
            width: 100%;
            padding: 12px 45px 12px 45px;
            border: none;
            border-radius: 25px;
            background: transparent;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .search-bar input:focus {
            outline: none;
            box-shadow: inset 0 0 5px rgba(0, 198, 255, 0.5);
        }

        .search-bar input:focus::placeholder {
            opacity: 0;
            transform: translateX(-15px);
        }

        .search-bar .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .search-bar input:focus+.search-icon {
            transform: translateY(-50%) scale(1.1);
        }

        .history-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .history-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .history-item .icon {
            margin-right: 10px;
            font-size: 18px;
            color: #00c6ff;
        }

        .history-item .content {
            flex-grow: 1;
            overflow: hidden;
        }

        .history-item .content .question {
            font-size: 15px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 180px;
        }

        .history-item .content .meta {
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 180px;
        }

        .history-item .delete-btn {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s ease;
        }

        .history-item .delete-btn:hover {
            color: #ff3f31;
        }

        .chat-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            border-radius: 12px;
            position: relative;
            z-index: 1;
        }

        .chat-box {
            border-radius: 12px;
            padding: 15px;
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 70px;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
            box-sizing: border-box;
        }

        .chat-box::-webkit-scrollbar {
            width: 8px;
        }

        .chat-box::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 12px;
        }

        .message {
            margin: 8px 12px;
            padding: 8px 12px;
            border-radius: 10px;
            width: fit-content;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        .message.user {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .markdown-container {
            line-height: 1.6;
            font-size: 15px;
        }

        .markdown-container pre {
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            position: relative;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .markdown-container code {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            font-weight: normal;
            background: none;
        }

        .markdown-container ul, .markdown-container ol {
            padding-left: 20px;
        }

        .markdown-container table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .markdown-container th, .markdown-container td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #00c6ff;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .copy-btn:hover {
            background: #0072ff;
        }

        .copy-btn.copied {
            background: #28a745;
        }

        .copy-btn.copied::after {
            content: '\f00c';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
        }

        .input-group {
            display: flex;
            position: fixed;
            bottom: 60px;
            left: 0;
            right: 0;
            border-radius: 50px;
            padding: 10px 20px;
            align-items: center;
            z-index: 100;
            background-color: inherit;
            max-width: 800px;
            margin: 0 auto 10px;
        }

        .input-group textarea {
            padding: 15px 60px 15px 60px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            resize: none;
            overflow-y: hidden;
            min-height: 50px;
            max-height: 150px;
            width: 100%;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            outline: none;
            scrollbar-width: thin;
            scrollbar-color: #00c6ff #333;
        }

        body[data-theme="light"] .input-group textarea {
            background-color: #e0e0e0;
            color: #333333;
        }

        body[data-theme="dark"] .input-group textarea {
            background-color: #3a3f4b;
            color: #ffffff;
        }

        body[data-theme="ocean"] .input-group textarea {
            background-color: #81d4fa;
            color: #003087;
        }

        body[data-theme="forest"] .input-group textarea {
            background-color: #a5d6a7;
            color: #1b5e20;
        }

        .input-group textarea:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .input-group textarea::-webkit-scrollbar {
            width: 8px;
        }

        .input-group textarea::-webkit-scrollbar-track {
            background: #333;
            border-radius: 10px;
        }

        .input-group textarea::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .input-group textarea::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #00a6dd, #005fcc);
        }

        .input-group textarea:focus {
            box-shadow: 0 0 5px rgba(0, 198, 255, 0.5);
        }

        .send-btn {
            position: absolute;
            right: 40px;
            bottom: 50%;
            transform: translateY(50%);
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
        }

        .stop-btn {
            position: absolute;
            right: 40px;
            bottom: 50%;
            transform: translateY(50%);
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            box-sizing: border-box;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .stop-btn:hover {
            filter: brightness(1.2);
            transform: translateY(50%) scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .stop-btn i {
            margin: 0;
            padding: 0;
            line-height: 1;
        }

        .voice-btn {
            position: absolute;
            left: 30px;
            bottom: 50%;
            transform: translateY(50%);
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
        }

        .send-btn:hover,
        .voice-btn:hover,
        .stop-btn:hover {
            filter: brightness(1.2);
        }

        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
        }

        .loader div {
            width: 10px;
            height: 10px;
            margin: 0 5px;
            border-radius: 50%;
            background-color: #3498db;
            animation: wave 1.5s infinite ease-in-out;
        }

        .loader div:nth-child(1) {
            animation-delay: -0.3s;
        }

        .loader div:nth-child(2) {
            animation-delay: -0.15s;
        }

        .loader div:nth-child(3) {
            animation-delay: 0s;
        }

        @keyframes wave {
            50%, 100% { transform: scale(0); }
            50% { transform: scale(1); }
        }

        footer {
            text-align: center;
            padding: 15px;
            background-color: transparent;
            position: fixed;
            bottom: 0;
            width: 100%;
            font-size: 14px;
            z-index: 100;
        }

        footer a {
            text-decoration: none;
            transition: all 0.3s ease;
        }

        footer a:hover {
            text-decoration: underline;
        }

        body[data-theme="light"] footer a:hover {
            color: #0056b3;
        }

        body[data-theme="dark"] footer a:hover {
            color: #00bcd4;
        }

        body[data-theme="ocean"] footer a:hover {
            color: #01579b;
        }

        body[data-theme="forest"] footer a:hover {
            color: #2e7d32;
        }

        .fancy-button {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.06);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fancy-button:hover {
            background: linear-gradient(135deg, #2575fc, #6a11cb);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .fancy-button:active {
            transform: scale(0.95);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }

        .clear-history-button {
            background: linear-gradient(135deg, #ff3f31, #ff6f61);
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.06);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 15px;
        }

        .clear-history-button:hover {
            background: linear-gradient(135deg, #ff6f61, #ff3f31);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .clear-history-button:active {
            transform: scale(0.95);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }

        .nav-right {
            display: flex;
            align-items: center;
        }

        .home-button {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            padding: 8px 20px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.06);
        }

        .home-button:hover {
            background: linear-gradient(135deg, #2575fc, #6a11cb);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
            color: #ffffff;
        }

        .home-button:active {
            transform: scale(0.95);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }

        .history-item:focus {
            outline: 2px solid #00c6ff;
            outline-offset: 2px;
        }

        /* Preview Panel */
        .preview-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            width: 400px;
            max-width: 90%;
            height: 500px;
            padding: 0;
            z-index: 1000;
            transition: all 0.3s ease;
            overflow: hidden;
            border-radius: 12px;
            display: none;
            cursor: move;
        }

        .preview-panel.active {
            display: block;
        }

        .preview-panel.minimized {
            height: 40px;
            overflow: hidden;
        }

        .preview-panel.maximized {
            width: 90%;
            height: calc(100vh - 100px);
            max-width: 800px;
        }

        .preview-panel .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: #ffffff;
            border-radius: 12px 12px 0 0;
            user-select: none;
        }

        .preview-panel .preview-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .preview-panel .preview-header .controls {
            display: flex;
            gap: 10px;
        }

        .preview-panel .preview-header button {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .preview-panel .preview-content {
            border-radius: 0 0 12px 12px;
            padding: 15px;
            overflow: auto;
            height: calc(100% - 40px);
        }

        .preview-panel .preview-content iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #ffffff;
        }

        .preview-panel .preview-content pre {
            margin: 0;
            padding: 15px;
            border-radius: 8px;
            background: #1e1e1e;
            color: #ffffff;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
        }

        .preview-panel::-webkit-scrollbar {
            width: 8px;
        }

        .preview-panel::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 50px;
        }

        .preview-panel::-webkit-scrollbar-track {
            border-radius: 50px;
        }

        body[data-theme="light"] .preview-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.7);
        }

        body[data-theme="dark"] .preview-panel::-webkit-scrollbar-track {
            background: rgba(20, 20, 20, 0.7);
        }

        body[data-theme="ocean"] .preview-panel::-webkit-scrollbar-track {
            background: rgba(179, 229, 252, 0.7);
        }

        body[data-theme="forest"] .preview-panel::-webkit-scrollbar-track {
            background: rgba(200, 230, 201, 0.7);
        }

        .toggle-preview {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: #ffffff;
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .toggle-preview:hover {
            background: linear-gradient(135deg, #2575fc, #6a11cb);
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .toggle-preview i {
            font-size: 20px;
        }

        /* Mobile Search Bar */
        .mobile-search-bar {
            display: none;
            position: fixed;
            bottom: 60px;
            left: 0;
            right: 0;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            z-index: 100;
        }

        .mobile-search-bar .search-bar {
            margin-bottom: 0;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .mobile-search-bar .search-bar input {
            padding: 10px 50px;
            font-size: 14px;
        }

        .mobile-search-bar .send-btn,
        .mobile-search-bar .voice-btn,
        .mobile-search-bar .stop-btn {
            width: 36px;
            height: 36px;
            font-size: 16px;
        }

        .mobile-search-bar .voice-btn {
            left: 15px;
        }

        .mobile-search-bar .send-btn {
            right: 15px;
        }

        .mobile-search-bar .stop-btn {
            right: 15px;
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 8px 15px;
            }

            .container {
                height: calc(100vh - 60px - 60px);
                margin-top: 60px;
                margin-bottom: 60px;
            }

            .chat-container {
                padding: 5px;
                border-radius: 8px;
            }

            .chat-box {
                padding: 10px;
                margin-bottom: 80px;
            }

            .input-group {
                display: none;
            }

            .mobile-search-bar {
                display: block;
            }

            footer {
                padding: 10px;
                font-size: 12px;
            }

            .message {
                max-width: 85%;
            }

            .navbar-brand {
                font-size: 1.5rem;
            }

            .toggle-history,
            .toggle-preview,
            .theme-dropdown .btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }

            .toggle-history i,
            .toggle-preview i {
                font-size: 18px;
            }

            .navbar-left,
            .navbar-center {
                gap: 8px;
            }

            .preview-panel {
                width: 100%;
                max-width: 100%;
                right: 0;
                top: 70px;
                height: calc(100vh - 80px);
                border-radius: 0;
            }

            .preview-panel.maximized {
                width: 100%;
                height: calc(100vh - 80px);
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <i class="fas fa-at loading-heartbeat" aria-hidden="true"></i>
    </div>

    <nav class="navbar navbar-dark">
        <div class="navbar-left">
            <button class="toggle-history" id="toggleHistory" aria-label="Toggle history panel">
                <i class="fas fa-clock"></i>
            </button>
            <button class="toggle-preview" id="togglePreview" aria-label="Toggle preview panel">
                <i class="fas fa-eye"></i>
            </button>
            <div class="theme-dropdown">
                <button class="btn dropdown-toggle theme-toggle-btn" type="button" id="themeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-adjust"></i>
                </button>
                <ul class="dropdown-menu" aria-labelledby="themeDropdown">
                    <li><a class="dropdown-item" href="#" data-theme="light">Light</a></li>
                    <li><a class="dropdown-item" href="#" data-theme="dark">Dark</a></li>
                    <li><a class="dropdown-item" href="#" data-theme="ocean">Ocean</a></li>
                    <li><a class="dropdown-item" href="#" data-theme="forest">Forest</a></li>
                </ul>
            </div>
            <button id="newChatBtn" class="fancy-button newChatBtn">New Chat</button>
        </div>
        <div class="navbar-center">
            <a class="navbar-brand"><i class="fas fa-comments"></i> Chat@AI</a>
        </div>
        <div class="nav-right">
            <a href="index.html" class="home-button">
                <i class="fas fa-home"></i>
            </a>
        </div>
    </nav>

    <div class="container">
        <aside class="history-panel" id="historyPanel">
            <button class="close-btn" id="closeHistoryBtn" aria-label="Close history panel">
                <i class="fas fa-times"></i>
            </button>
            <div class="search-bar">
                <input type="text" id="searchBar" placeholder="Search or enter code..." aria-label="Search chat history or enter code">
                <span class="search-icon"><i class="fas fa-search"></i></span>
                <span class="clear-search" id="clearSearch"><i class="fas fa-times"></i></span>
            </div>
            <button class="clear-history-button" id="clearHistoryBtn">Clear All History</button>
            <button class="fancy-button" id="exportHistoryBtn">Export History</button>
            <button class="fancy-button" id="importHistoryBtn">Import History</button>
            <h3>Chat History</h3>
            <div id="chatHistory"></div>
        </aside>

        <aside class="preview-panel" id="previewPanel">
            <div class="preview-header" aria-label="Preview panel header">
                <h3>Code Preview</h3>
                <div class="controls">
                    <button class="minimize-btn" id="minimizePreviewBtn" aria-label="Minimize preview panel">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button class="maximize-btn" id="maximizePreviewBtn" aria-label="Maximize preview panel">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="close-preview-btn" id="closePreviewBtn" aria-label="Close preview panel">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="preview-content" id="previewContent"></div>
        </aside>

        <div class="chat-container">
            <div class="chat-box" id="chatBox"></div>
            <div class="input-group">
                <textarea id="userInput" placeholder="Ask Anything or Enter Code..." rows="1" aria-label="Enter your message or code"></textarea>
                <button class="send-btn" id="sendBtn" aria-label="Send message"><i class="fas fa-paper-plane"></i></button>
                <button class="stop-btn" id="stopBtn" style="display: none;" aria-label="Stop generation"><i class="fas fa-stop"></i></button>
                <button class="voice-btn" id="voiceBtn" aria-label="Toggle voice input"><i class="fas fa-microphone"></i></button>
            </div>
        </div>
    </div>

    <div class="mobile-search-bar">
        <div class="search-bar">
            <input type="text" id="mobileUserInput" placeholder="Ask Anything or Enter Code..." aria-label="Enter your message or code">
            <span class="search-icon"><i class="fas fa-search"></i></span>
            <button class="send-btn" id="mobileSendBtn" aria-label="Send message"><i class="fas fa-paper-plane"></i></button>
            <button class="stop-btn" id="mobileStopBtn" style="display: none;" aria-label="Stop generation"><i class="fas fa-stop"></i></button>
            <button class="voice-btn" id="mobileVoiceBtn" aria-label="Toggle voice input"><i class="fas fa-microphone"></i></button>
        </div>
    </div>

    <footer>
        <p> 2025 AI Chatbot | <a href="#" class="footer-link">Privacy Policy</a> | <a href="#" class="footer-link">Terms of Service</a></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@4.0.12/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <script>
        // UUID generator
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                const r = Math.random() * 16 | 0;
                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
        }

        // Constants
        const baseUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
        const apiKey = 'AIzaSyDirhQ899FnmcWCuwfHfzS05TEenhZntwA'; // Replace with your actual Gemini API key
        const maxContextMessages = 5;
        const typingSpeed = 5; // Milliseconds per character
        const maxHistoryLength = 50; // Max characters for history question and response
        const scrollThreshold = 100; // Pixels from bottom to trigger auto-scroll
        const elements = {
            chatBox: document.getElementById('chatBox'),
            userInput: document.getElementById('userInput'),
            sendBtn: document.getElementById('sendBtn'),
            stopBtn: document.getElementById('stopBtn'),
            voiceBtn: document.getElementById('voiceBtn'),
            mobileUserInput: document.getElementById('mobileUserInput'),
            mobileSendBtn: document.getElementById('mobileSendBtn'),
            mobileStopBtn: document.getElementById('mobileStopBtn'),
            mobileVoiceBtn: document.getElementById('mobileVoiceBtn'),
            chatHistory: document.getElementById('chatHistory'),
            searchBar: document.getElementById('searchBar'),
            clearSearch: document.getElementById('clearSearch'),
            newChatBtn: document.getElementById('newChatBtn'),
            historyPanel: document.getElementById('historyPanel'),
            toggleHistory: document.getElementById('toggleHistory'),
            closeHistoryBtn: document.getElementById('closeHistoryBtn'),
            clearHistoryBtn: document.getElementById('clearHistoryBtn'),
            exportHistoryBtn: document.getElementById('exportHistoryBtn'),
            importHistoryBtn: document.getElementById('importHistoryBtn'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            previewPanel: document.getElementById('previewPanel'),
            togglePreview: document.getElementById('togglePreview'),
            closePreviewBtn: document.getElementById('closePreviewBtn'),
            minimizePreviewBtn: document.getElementById('minimizePreviewBtn'),
            maximizePreviewBtn: document.getElementById('maximizePreviewBtn'),
            previewContent: document.getElementById('previewContent')
        };
        let recognizing = false;
        let abortController = null;
        let isTypingStopped = false;
        let isGenerating = false;
        let isTyping = false;
        let currentQuestion = '';
        let isDragging = false;
        let isMinimized = false;
        let isMaximized = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        // Theme Management
        function setTheme(theme) {
            const validThemes = ['light', 'dark', 'ocean', 'forest'];
            if (!validThemes.includes(theme)) {
                theme = 'light';
                localStorage.setItem('theme', 'light');
            }

            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);

            const themeBtn = document.querySelector('.theme-toggle-btn');
            themeBtn.textContent = theme === 'light' ? '' :
                                  theme === 'dark' ? '' :
                                  theme === 'ocean' ? '' : '';

            updateTextColor();
        }

        function updateTextColor() {
            const currentTheme = document.body.getAttribute('data-theme');
            let textColor;

            switch (currentTheme) {
                case 'light':
                    textColor = '#333333';
                    break;
                case 'dark':
                    textColor = '#ffffff';
                    break;
                case 'ocean':
                    textColor = '#003087';
                    break;
                case 'forest':
                    textColor = '#1b5e20';
                    break;
                default:
                    textColor = '#333333';
            }

            document.body.style.color = textColor;
            document.querySelectorAll('.message.bot').forEach(element => {
                element.style.color = textColor;
            });
            document.querySelectorAll('.markdown-container').forEach(element => {
                element.style.color = textColor;
            });
            document.querySelectorAll('.markdown-container code').forEach(element => {
                element.style.color = textColor;
            });
        }

        document.querySelectorAll('.theme-dropdown .dropdown-item').forEach(item => {
            item.addEventListener('click', e => {
                e.preventDefault();
                setTheme(item.getAttribute('data-theme'));
            });
        });

        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        // Panel Management
        function toggleHistoryPanel() {
            elements.historyPanel.classList.toggle('active');
        }

        function togglePreviewPanel() {
            elements.previewPanel.classList.toggle('active');
            if (!elements.previewPanel.classList.contains('active')) {
                isMinimized = false;
                isMaximized = false;
                elements.previewPanel.classList.remove('minimized', 'maximized');
                elements.maximizePreviewBtn.querySelector('i').className = 'fas fa-expand';
            }
        }

        function closePanels(event) {
            const isHistoryPanelClick = elements.historyPanel.contains(event.target) || elements.toggleHistory.contains(event.target);
            const isPreviewPanelClick = elements.previewPanel.contains(event.target) || elements.togglePreview.contains(event.target);
            const isNavbarClick = event.target.closest('.navbar');

            if (!isHistoryPanelClick && elements.historyPanel.classList.contains('active') && !isNavbarClick) {
                toggleHistoryPanel();
            }
            if (!isPreviewPanelClick && elements.previewPanel.classList.contains('active') && !isNavbarClick) {
                togglePreviewPanel();
            }
        }

        elements.toggleHistory.addEventListener('click', toggleHistoryPanel);
        elements.closeHistoryBtn.addEventListener('click', toggleHistoryPanel);
        elements.togglePreview.addEventListener('click', togglePreviewPanel);
        elements.closePreviewBtn.addEventListener('click', togglePreviewPanel);
        document.addEventListener('click', closePanels);

        // Preview Panel Controls
        function minimizePreview() {
            isMinimized = !isMinimized;
            elements.previewPanel.classList.toggle('minimized', isMinimized);
            elements.minimizePreviewBtn.querySelector('i').className = isMinimized ? 'fas fa-plus' : 'fas fa-minus';
            elements.minimizePreviewBtn.setAttribute('aria-label', isMinimized ? 'Restore preview panel' : 'Minimize preview panel');
        }

        function maximizePreview() {
            isMaximized = !isMaximized;
            elements.previewPanel.classList.toggle('maximized', isMaximized);
            elements.maximizePreviewBtn.querySelector('i').className = isMaximized ? 'fas fa-compress' : 'fas fa-expand';
            elements.maximizePreviewBtn.setAttribute('aria-label', isMaximized ? 'Restore preview panel' : 'Maximize preview panel');
            if (isMaximized) {
                isMinimized = false;
                elements.previewPanel.classList.remove('minimized');
                elements.minimizePreviewBtn.querySelector('i').className = 'fas fa-minus';
                elements.minimizePreviewBtn.setAttribute('aria-label', 'Minimize preview panel');
            }
        }

        elements.minimizePreviewBtn.addEventListener('click', minimizePreview);
        elements.maximizePreviewBtn.addEventListener('click', maximizePreview);

        // Draggable Preview Panel
        const header = elements.previewPanel.querySelector('.preview-header');
        header.addEventListener('mousedown', startDragging);
        header.addEventListener('touchstart', startDragging);

        function startDragging(e) {
            if (e.target.closest('.controls')) return; // Ignore clicks on buttons
            e.preventDefault();
            isDragging = true;
            const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
            dragOffsetX = clientX - elements.previewPanel.offsetLeft;
            dragOffsetY = clientY - elements.previewPanel.offsetTop;
            document.addEventListener('mousemove', dragPanel);
            document.addEventListener('touchmove', dragPanel);
            document.addEventListener('mouseup', stopDragging);
            document.addEventListener('touchend', stopDragging);
        }

        function dragPanel(e) {
            if (!isDragging) return;
            const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
            let newLeft = clientX - dragOffsetX;
            let newTop = clientY - dragOffsetY;

            // Boundary constraints
            const container = document.querySelector('.container');
            const rect = container.getBoundingClientRect();
            const panelWidth = elements.previewPanel.offsetWidth;
            const panelHeight = elements.previewPanel.offsetHeight;

            newLeft = Math.max(rect.left, Math.min(newLeft, rect.right - panelWidth));
            newTop = Math.max(rect.top, Math.min(newTop, rect.bottom - (isMinimized ? 40 : panelHeight)));

            elements.previewPanel.style.left = `${newLeft - rect.left}px`;
            elements.previewPanel.style.top = `${newTop - rect.top}px`;
        }

        function stopDragging() {
            isDragging = false;
            document.removeEventListener('mousemove', dragPanel);
            document.removeEventListener('touchmove', dragPanel);
            document.removeEventListener('mouseup', stopDragging);
            document.removeEventListener('touchend', stopDragging);
        }

        // Chat History Management
        class ChatHistory {
            static load() {
                const compressed = localStorage.getItem('chatHistory');
                let history = compressed ? JSON.parse(LZString.decompress(compressed) || '[]') : [];
                
                history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                elements.chatHistory.innerHTML = '';
                history.forEach(item => this.renderHistoryItem(item));
            }

            static save(history) {
                const compressed = LZString.compress(JSON.stringify(history));
                localStorage.setItem('chatHistory', compressed);
            }

            static add(question, response, sender) {
                const sessionId = generateUUID();
                const timestamp = new Date().toISOString();
                const keyword = this.summarizeResponse(response);
                const item = { sessionId, timestamp, question, response, sender, keyword };
                const history = JSON.parse(LZString.decompress(localStorage.getItem('chatHistory') || '[]') || '[]');
                history.push(item);
                this.save(history);
                this.load();
            }

            static summarizeResponse(response) {
                return response.split(' ').slice(0, 5).join(' ') + '...';
            }

            static renderHistoryItem({ sessionId, timestamp, question, response, keyword }) {
                const historyItem = document.createElement('div');
                historyItem.classList.add('history-item');
                historyItem.tabIndex = 0;
                historyItem.setAttribute('aria-label', `Chat from ${question}`);

                const isImage = question.startsWith('/generate_image');
                const isCode = question.startsWith('```javascript') || response.includes('```');
                const icon = document.createElement('i');
                icon.className = isImage ? 'fas fa-image icon' : isCode ? 'fas fa-code icon' : 'fas fa-comment icon';

                const content = document.createElement('div');
                content.className = 'content';

                const date = new Date(timestamp);
                const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const formattedDate = date.toLocaleDateString();

                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.textContent = question;
                questionDiv.title = question;

                const metaDiv = document.createElement('div');
                metaDiv.className = 'meta';
                metaDiv.textContent = `${formattedDate} ${formattedTime} | ${keyword}`;
                metaDiv.title = `${formattedDate} ${formattedTime} | ${keyword}`;

                content.appendChild(questionDiv);
                content.appendChild(metaDiv);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.setAttribute('aria-label', 'Delete chat history item');
                deleteBtn.addEventListener('click', e => {
                    e.stopPropagation();
                    elements.chatHistory.removeChild(historyItem);
                    const history = JSON.parse(LZString.decompress(localStorage.getItem('chatHistory') || '[]') || '[]');
                    const updatedHistory = history.filter(item => item.sessionId !== sessionId);
                    this.save(updatedHistory);
                    this.load();
                });

                historyItem.appendChild(icon);
                historyItem.appendChild(content);
                historyItem.appendChild(deleteBtn);

                historyItem.addEventListener('click', () => {
                    appendMessage(`**Previous:** ${question}\n${response}`, 'bot', sessionId, timestamp);
                    toggleHistoryPanel();
                    if (response.includes('```')) {
                        showCodePreview(response);
                    }
                });

                elements.chatHistory.prepend(historyItem);
            }

            static clear() {
                if (confirm('Are you sure you want to permanently delete all chat history? This action cannot be undone.')) {
                    elements.chatHistory.innerHTML = '';
                    localStorage.removeItem('chatHistory');
                    appendMessage('All chat history has been permanently deleted.', 'bot');
                }
            }

            static export() {
                const history = JSON.parse(LZString.decompress(localStorage.getItem('chatHistory') || '[]') || '[]');
                const blob = new Blob([JSON.stringify(history, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'chat_history.json';
                a.click();
                URL.revokeObjectURL(url);
            }

            static import() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = e => {
                    const file = e.target.files[0];
                                        if (!file) return;
                    const reader = new FileReader();
                    reader.onload = event => {
                        try {
                            const history = JSON.parse(event.target.result);
                            this.save(history);
                            this.load();
                            appendMessage('Chat history imported successfully.', 'bot');
                        } catch (error) {
                            appendMessage(`Error importing history: ${error.message}`, 'bot');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }
        }

        // Response Formatting for Bot Messages
        function formatResponse(response) {
            const html = marked.parse(response, {
                gfm: true,
                breaks: true,
                sanitize: true
            });
            return `<div class="markdown-container">${html}</div>`;
        }

        // Parse and Render User Input with Code Blocks
        function renderUserInput(content) {
            const messageContent = document.createElement('div');
            messageContent.classList.add('markdown-container');

            const parts = content.split(/(```[\s\S]*?```)/);
            parts.forEach(part => {
                if (part.startsWith('```') && part.endsWith('```')) {
                    const codeBlock = part.slice(3, -3).trim();
                    const firstLineEnd = codeBlock.indexOf('\n');
                    let language = '';
                    let code = codeBlock;
                    if (firstLineEnd !== -1 && !codeBlock.slice(0, firstLineEnd).includes(' ')) {
                        language = codeBlock.slice(0, firstLineEnd).trim();
                        code = codeBlock.slice(firstLineEnd + 1).trim();
                    }

                    const pre = document.createElement('pre');
                    const codeElement = document.createElement('code');
                    codeElement.textContent = code;
                    pre.appendChild(codeElement);
                    messageContent.appendChild(pre);
                } else {
                    if (part.trim()) {
                        const p = document.createElement('p');
                        p.textContent = part;
                        messageContent.appendChild(p);
                    }
                }
            });

            return messageContent;
        }

        // Typing Effect with Stop Capability
        function typeMessage(element, html, callback, originalResponse) {
            element.innerHTML = '<div class="markdown-container"></div>';
            const container = element.querySelector('.markdown-container');
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const nodes = Array.from(doc.querySelector('.markdown-container').childNodes);

            let nodeIndex = 0;
            let charIndex = 0;
            let currentElement = null;
            let typedContent = ''; // Store the typed content as plain text

            function typeNext() {
                if (isTypingStopped) {
                    addCopyButtons(container);
                    // Save the partially typed content to history
                    if (typedContent && currentQuestion) {
                        ChatHistory.add(currentQuestion, typedContent);
                    }
                    callback();
                    return;
                }

                if (nodeIndex >= nodes.length) {
                    addCopyButtons(container);
                    // Save the full response to history when complete
                    if (originalResponse && currentQuestion) {
                        ChatHistory.add(currentQuestion, originalResponse);
                    }
                    callback();
                    return;
                }

                const node = nodes[nodeIndex];
                if (node.nodeType === Node.ELEMENT_NODE) {
                    if (!currentElement) {
                        currentElement = node.cloneNode(false);
                        container.appendChild(currentElement);
                    }

                    if (node.childNodes.length > 0) {
                        nodes.splice(nodeIndex, 1, ...node.childNodes);
                    } else {
                        nodeIndex++;
                        currentElement = null;
                    }
                } else if (node.nodeType === Node.TEXT_NODE) {
                    const text = node.textContent;
                    if (charIndex < text.length) {
                        if (!currentElement) {
                            currentElement = document.createTextNode('');
                            container.appendChild(currentElement);
                        }
                        currentElement.textContent = text.slice(0, charIndex + 1);
                        typedContent += text[charIndex]; // Accumulate plain text
                        charIndex++;
                        // Only auto-scroll if the user is near the bottom
                        const scrollPosition = elements.chatBox.scrollTop + elements.chatBox.clientHeight;
                        const scrollHeight = elements.chatBox.scrollHeight;
                        if (scrollHeight - scrollPosition < scrollThreshold) {
                            elements.chatBox.scrollTop = elements.chatBox.scrollHeight;
                        }
                    } else {
                        nodeIndex++;
                        charIndex = 0;
                        currentElement = null;
                    }
                } else {
                    nodeIndex++;
                }

                setTimeout(typeNext, typingSpeed);
            }

            typeNext();
        }

        // Add Copy Buttons to Code Blocks
        function addCopyButtons(container) {
            container.querySelectorAll('pre').forEach(pre => {
                let codeText = pre.textContent;
                if (pre.querySelector('code')) {
                    codeText = pre.querySelector('code').textContent;
                }

                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.innerHTML = '<i class="fas fa-copy"></i>';
                button.setAttribute('aria-label', 'Copy code');
                button.addEventListener('click', () => {
                    navigator.clipboard.writeText(codeText).then(() => {
                        button.classList.add('copied');
                        setTimeout(() => button.classList.remove('copied'), 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                    });
                });

                pre.appendChild(button);
            });
        }

        // Show Code Preview
        function showCodePreview(response) {
            const codeBlockRegex = /```(\w+)?\n([\s\S]*?)\n```/;
            const match = response.match(codeBlockRegex);
            if (!match) return;

            const language = (match[1] || '').toLowerCase();
            const code = match[2].trim();

            elements.previewContent.innerHTML = '';

            if (language === 'html' || language === 'javascript') {
                try {
                    const blob = new Blob([code], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const iframe = document.createElement('iframe');
                    iframe.src = url;
                    elements.previewContent.appendChild(iframe);
                    setTimeout(() => URL.revokeObjectURL(url), 30000);
                } catch (error) {
                    const pre = document.createElement('pre');
                    pre.textContent = `Error rendering preview: ${error.message}\n\n${code}`;
                    elements.previewContent.appendChild(pre);
                }
            } else {
                const pre = document.createElement('pre');
                const codeElement = document.createElement('code');
                codeElement.textContent = code;
                pre.appendChild(codeElement);
                elements.previewContent.appendChild(pre);
                addCopyButtons(elements.previewContent);
            }

            elements.previewPanel.classList.add('active');
            // Reset position to default when opening
            elements.previewPanel.style.left = '';
            elements.previewPanel.style.top = '';
        }

        // Append Message to Chat Box
        function appendMessage(content, sender, sessionId = null, timestamp = null) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);

            if (sender === 'bot') {
                const iconImg = document.createElement('img');
                iconImg.src = 'https://i.ibb.co/MCLkk0y/icon-png.webp';
                iconImg.alt = 'Chat @_BIND_ AI Bot';
                iconImg.style.width = '50px';
                iconImg.style.height = '40px';
                iconImg.style.marginRight = '10px';
                iconImg.style.borderRadius = '50%';
                iconImg.style.objectFit = 'cover';

                const messageContainer = document.createElement('div');
                messageContainer.style.display = 'flex';
                messageContainer.style.alignItems = 'flex-start';

                const messageContent = document.createElement('div');
                messageContent.style.minWidth = '100px';

                messageContainer.appendChild(iconImg);
                messageContainer.appendChild(messageContent);
                messageDiv.appendChild(messageContainer);

                if (sessionId && timestamp) {
                    messageContent.innerHTML = formatResponse(content);
                    addCopyButtons(messageContent);
                } else {
                    isTyping = true;
                    typeMessage(messageContent, formatResponse(content), () => {
                        isTyping = false;
                        isGenerating = false;
                        toggleInputState(true);
                    }, content);
                }
            } else {
                const messageContent = renderUserInput(content);
                messageDiv.appendChild(messageContent);
            }

            elements.chatBox.appendChild(messageDiv);
            elements.chatBox.scrollTop = elements.chatBox.scrollHeight;
        }

        // Toggle Input State
        function toggleInputState(enable) {
            elements.userInput.disabled = !enable;
            elements.mobileUserInput.disabled = !enable;
            elements.sendBtn.style.display = enable ? 'flex' : 'none';
            elements.mobileSendBtn.style.display = enable ? 'flex' : 'none';
            elements.stopBtn.style.display = enable ? 'none' : 'flex';
            elements.mobileStopBtn.style.display = enable ? 'none' : 'flex';
        }

        // Stop Generation
        function stopGeneration() {
            if (abortController) {
                abortController.abort();
                abortController = null;
            }
            isTypingStopped = true;
            isGenerating = false;
            toggleInputState(true);
            removeLoader();
        }

        // Append Loader to Chat Box
        function appendLoader() {
            const loaderDiv = document.createElement('div');
            loaderDiv.classList.add('loader');
            loaderDiv.innerHTML = `
                <div></div>
                <div></div>
                <div></div>
            `;
            loaderDiv.id = 'chatLoader';
            elements.chatBox.appendChild(loaderDiv);
            elements.chatBox.scrollTop = elements.chatBox.scrollHeight;
            return loaderDiv;
        }

        // Remove Loader from Chat Box
        function removeLoader() {
            const loader = document.getElementById('chatLoader');
            if (loader) {
                loader.remove();
            }
        }

        // Fetch Response from Gemini API
        async function fetchResponse(prompt, contextMessages = []) {
            abortController = new AbortController();
            isTypingStopped = false;

            const requestBody = {
                contents: [
                    ...contextMessages.map(msg => ({
                        role: msg.sender === 'user' ? 'user' : 'model',
                        parts: [{ text: msg.content }]
                    })),
                    { role: 'user', parts: [{ text: prompt }] }
                ]
            };

            try {
                const response = await fetch(`${baseUrl}?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody),
                    signal: abortController.signal
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                const content = data.candidates[0].content.parts[0].text;
                return content;
            } catch (error) {
                if (error.name === 'AbortError') {
                    return '';
                }
                console.error('Error fetching response:', error);
                return `Error: ${error.message}`;
            }
        }

        // Handle Send Message
        async function sendMessage(inputElement, isMobile = false) {
            const prompt = inputElement.value.trim();
            if (!prompt || isGenerating || isTyping) return;

            isGenerating = true;
            toggleInputState(false);
            currentQuestion = prompt;
            appendMessage(prompt, 'user');
            inputElement.value = '';

            const loader = appendLoader();

            const messages = Array.from(elements.chatBox.querySelectorAll('.message')).slice(-maxContextMessages * 2);
            const contextMessages = messages.map(msg => ({
                sender: msg.classList.contains('user') ? 'user' : 'bot',
                content: msg.textContent
            }));

            try {
                const response = await fetchResponse(prompt, contextMessages);
                removeLoader();

                if (response) {
                    appendMessage(response, 'bot');
                    if (response.includes('```')) {
                        showCodePreview(response);
                    }
                } else if (isTypingStopped) {
                    // Handled in typeMessage
                } else {
                    appendMessage('No response received.', 'bot');
                }
            } catch (error) {
                removeLoader();
                appendMessage(`Error: ${error.message}`, 'bot');
            }
        }

        // Event Listeners
        elements.sendBtn.addEventListener('click', () => sendMessage(elements.userInput));
        elements.mobileSendBtn.addEventListener('click', () => sendMessage(elements.mobileUserInput, true));
        elements.stopBtn.addEventListener('click', stopGeneration);
        elements.mobileStopBtn.addEventListener('click', stopGeneration);

        elements.userInput.addEventListener('keypress', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage(elements.userInput);
            }
        });

        elements.mobileUserInput.addEventListener('keypress', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage(elements.mobileUserInput, true);
            }
        });

        // Auto-resize Textarea
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = `${Math.min(textarea.scrollHeight, 150)}px`;
        }

        elements.userInput.addEventListener('input', () => autoResize(elements.userInput));
        elements.mobileUserInput.addEventListener('input', () => autoResize(elements.mobileUserInput));

        // Voice Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                recognizing = true;
                elements.voiceBtn.classList.add('active');
                elements.mobileVoiceBtn.classList.add('active');
            };

            recognition.onresult = event => {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                elements.userInput.value = transcript;
                elements.mobileUserInput.value = transcript;
                autoResize(elements.userInput);
                autoResize(elements.mobileUserInput);
            };

            recognition.onend = () => {
                recognizing = false;
                elements.voiceBtn.classList.remove('active');
                elements.mobileVoiceBtn.classList.remove('active');
            };

            elements.voiceBtn.addEventListener('click', () => {
                if (recognizing) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            });

            elements.mobileVoiceBtn.addEventListener('click', () => {
                if (recognizing) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            });
        } else {
            elements.voiceBtn.style.display = 'none';
            elements.mobileVoiceBtn.style.display = 'none';
        }

        // Search History
        elements.searchBar.addEventListener('input', () => {
            const query = elements.searchBar.value.toLowerCase();
            const history = JSON.parse(LZString.decompress(localStorage.getItem('chatHistory') || '[]') || '[]');
            elements.chatHistory.innerHTML = '';
            history
                .filter(item => item.question.toLowerCase().includes(query) || item.response.toLowerCase().includes(query))
                .forEach(item => ChatHistory.renderHistoryItem(item));
        });

        elements.clearSearch.addEventListener('click', () => {
            elements.searchBar.value = '';
            ChatHistory.load();
        });

        // New Chat
        elements.newChatBtn.addEventListener('click', () => {
            elements.chatBox.innerHTML = '';
            elements.userInput.value = '';
            elements.mobileUserInput.value = '';
            currentQuestion = '';
        });

        // Clear History
        elements.clearHistoryBtn.addEventListener('click', () => ChatHistory.clear());

        // Export/Import History
        elements.exportHistoryBtn.addEventListener('click', () => ChatHistory.export());
        elements.importHistoryBtn.addEventListener('click', () => ChatHistory.import());

        // Initialize
        ChatHistory.load();
        setTimeout(() => {
            elements.loadingOverlay.classList.add('hidden');
            setTimeout(() => elements.loadingOverlay.style.display = 'none', 500);
            appendMessage('Welcome to Chat@AI! How can I assist you today?', 'bot');
        }, 1000);

        // Accessibility Enhancements
        document.querySelectorAll('.history-item').forEach(item => {
            item.addEventListener('keydown', e => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    item.click();
                }
            });
        });

        // Keyboard Accessibility for Preview Panel Buttons
        [elements.minimizePreviewBtn, elements.maximizePreviewBtn, elements.closePreviewBtn].forEach(btn => {
            btn.addEventListener('keydown', e => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    btn.click();
                }
            });
        });
    </script>
</body>
</html>
